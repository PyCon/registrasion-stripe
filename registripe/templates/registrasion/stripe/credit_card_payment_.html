{% extends "registrasion/base.html" %}
{% load registrasion_tags %}

{% block title %}Credit card payment for invoice #{{ invoice.id}}{% endblock %}
{% block heading %}Credit card payment for invoice #{{ invoice.id}}{% endblock %}
{% block lede %}
  Credit card payments are processed by <a href="https://stripe.com">Stripe</a>.
  We do not store any of your credit card data locally, but instead Stripe will securely tokenise your card details. To allow this, you must allow JavaScript from <code>js.stripe.com</code>.{% endblock %}

{% block content %}

  {% block balance_due_outer %}
    <div>
      <p>
        {% block balance_due %}
          You have ${{ invoice.balance_due }} remaining to pay on this invoice.
        {% endblock %}
      </p>
    </div>
  {% endblock %}

  <h3>Card details</h3>

  <form id="payment-form" method="post">

    <div class="alert alert-danger" id="payment-errors" style="display: none;">
      <a class="close" data-dismiss="alert">Ã—</a>
    </div>

    {% csrf_token %}
    {% include "registrasion/form.html" %}

    <div class="form-actions">
      <input id="pay" class="btn btn-primary" type="submit" value="Pay {{ invoice.balance_due }}" />
    </div>

  </form>

  {% block form_scripts %}
    {% block add_form_control_class_script %}
      <script>
        elements = document.getElementsByClassName("registrasion-stripe-element");
        Array.prototype.forEach.call(elements, function(element) {
          element.setAttribute("class", "{% block form_control_class %}form-control{% endblock %}");
        });
      </script>
    {% endblock %}

    {{ form.media.js }}
  {% endblock %}

{% endblock %}
